<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <title>GeminiDesk Settings</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap');
        
        :root {
            --bg-primary: #1e1e1e; --bg-secondary: #252526; --bg-tertiary: #2d2d30;
            --text-primary: #cccccc; --text-secondary: #9e9e9e; --accent-primary: #0e98d9;
            --accent-secondary: #3c3c3c; --danger-color: #f44336; --success-color: #4caf50;
            --border-color: #3e3e42;
        }

        html.light-mode {
            --bg-primary: #f5f5f5; --bg-secondary: #ffffff; --bg-tertiary: #e0e0e0;
            --text-primary: #212121; --text-secondary: #757575; --accent-primary: #007aff;
            --accent-secondary: #e9e9e9; --danger-color: #d32f2f; --success-color: #388e3c;
            --border-color: #dcdcdc;
        }

        html, body {
            margin: 0; padding: 0; background-color: var(--bg-primary);
            color: var(--text-primary); font-family: 'Poppins', sans-serif;
            overflow: hidden; -webkit-font-smoothing: antialiased; user-select: none;
        }

        .drag-bar {
            width: 100%; height: 40px; -webkit-app-region: drag; background-color: var(--bg-secondary);
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 15px; box-sizing: border-box; border-bottom: 1px solid var(--border-color);
        }

        .drag-bar h2 { font-size: 16px; margin: 0; font-weight: 500; color: var(--text-primary); -webkit-app-region: drag; }

        #close-button {
            -webkit-app-region: no-drag; font-size: 22px; background: none; border: none;
            color: var(--text-secondary); cursor: pointer; transition: transform .2s ease, color .2s ease;
            padding: 5px; line-height: 1;
        }
        #close-button:hover { transform: rotate(90deg); color: var(--accent-primary); }

        .content { padding: 20px; overflow-y: auto; height: calc(100vh - 40px); }
        .content::-webkit-scrollbar { width: 8px; }
        .content::-webkit-scrollbar-track { background: var(--bg-primary); }
        .content::-webkit-scrollbar-thumb { background-color: var(--accent-secondary); border-radius: 4px; }

        .setting-category { margin-bottom: 30px; }
        .setting-category-title {
            font-weight: 600; font-size: 12px; text-transform: uppercase; letter-spacing: 1px;
            color: var(--accent-primary); margin-bottom: 15px; padding-bottom: 8px;
            border-bottom: 1px solid var(--border-color); display: flex; align-items: center;
        }
        .setting-category-title svg { width: 16px; height: 16px; margin-right: 8px; }

        .setting-item {
            background-color: var(--bg-secondary); border-radius: 8px; padding: 15px;
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 10px; border: 1px solid var(--border-color);
            transition: border-color .2s ease, box-shadow .2s ease;
        }
        .setting-item:hover { border-color: var(--accent-secondary); }
        
        .setting-label { display: flex; flex-direction: column; }
        .setting-label strong { font-weight: 500; font-size: 14px; }
        .setting-label span { font-size: 12px; color: var(--text-secondary); margin-top: 4px; }

        .toggle-switch { position: relative; display: inline-block; width: 44px; height: 24px; flex-shrink: 0; }
        .toggle-switch input { display: none; }
        .slider {
            position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0;
            background-color: var(--accent-secondary); transition: .3s; border-radius: 34px;
        }
        .slider:before {
            position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px;
            background-color: #fff; transition: .3s; border-radius: 50%; box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        input:checked + .slider { background-color: var(--success-color); }
        input:checked + .slider:before { transform: translateX(20px); }

        .record-button, .action-button {
            background-color: var(--bg-tertiary); border: 1px solid var(--border-color); color: var(--text-primary);
            padding: 8px 12px; border-radius: 6px; cursor: pointer; font-family: 'Poppins', sans-serif;
            font-size: 13px; min-width: 130px; text-align: center; transition: all .2s ease;
        }
        .record-button:hover, .action-button:hover { border-color: var(--accent-primary); color: var(--accent-primary); }
        .record-button.is-recording { background-color: var(--accent-primary); border-color: var(--accent-primary); color: #fff; font-weight: 600; cursor: default; }

        #reset-button {
            border: 1px solid var(--danger-color); background: transparent; color: var(--danger-color);
            padding: 8px 15px; border-radius: 6px; cursor: pointer;
            font-size: 14px; font-weight: 500; transition: background-color .2s, color .2s;
            font-family: 'Poppins', sans-serif;
        }
        #reset-button:hover { background-color: var(--danger-color); color: #fff; }

        #notification-status-text {
            font-size: 12px;
            color: var(--text-secondary);
            margin-right: 15px;
            min-width: 100px;
            text-align: left;
            transition: opacity 0.3s ease;
        }
        
        #update-status-text {
            font-size: 12px;
            color: var(--text-secondary);
            margin-left: 15px;
            min-width: 100px;
            text-align: right;
        }

        /* --- RTL Support --- */
        html[dir="rtl"] {
            direction: rtl;
        }

        html[dir="rtl"] .drag-bar {
            direction: rtl;
        }

        html[dir="rtl"] .setting-category-title {
            direction: rtl;
        }

        html[dir="rtl"] .setting-category-title svg {
            margin-left: 8px;
            margin-right: 0;
        }

        html[dir="rtl"] .setting-item {
            direction: rtl;
        }

        html[dir="rtl"] .setting-label {
            text-align: right;
        }

        html[dir="rtl"] .setting-label strong {
            text-align: right;
        }

        html[dir="rtl"] .setting-label span {
            text-align: right;
        }

        html[dir="rtl"] #notification-status-text {
            margin-left: 15px;
            margin-right: 0;
            text-align: right;
        }

        html[dir="rtl"] #update-status-text {
            margin-right: 15px;
            margin-left: 0;
            text-align: left;
        }

        html[dir="rtl"] .toggle-switch .slider:before {
            left: auto;
            right: 3px;
        }

        html[dir="rtl"] input:checked + .slider:before {
            transform: translateX(-20px);
        }

        html[dir="rtl"] .record-button,
        html[dir="rtl"] .action-button {
            text-align: center;
        }

        html[dir="rtl"] #reset-button {
            text-align: center;
        }

        /* --- Custom Option Group Selector --- */
        .option-group {
            display: flex;
            background-color: var(--bg-tertiary);
            border-radius: 6px;
            border: 1px solid var(--border-color);
            overflow: hidden;
        }
        .option-group input[type="radio"] {
            display: none; /* Hide the actual radio button */
        }
        .option-group label {
            padding: 6px 12px;
            cursor: pointer;
            color: var(--text-secondary);
            font-size: 13px;
            transition: background-color 0.2s ease, color 0.2s ease;
            border-left: 1px solid var(--border-color);
        }
        .option-group label:first-of-type {
            border-left: none;
        }
        .option-group input[type="radio"]:checked + label {
            background-color: var(--accent-primary);
            color: #fff;
            font-weight: 500;
        }
        .option-group label:hover {
            background-color: var(--accent-secondary);
        }

        html[dir="rtl"] .option-group {
            flex-direction: row-reverse;
        }
        html[dir="rtl"] .option-group label {
            border-left: none;
            border-right: 1px solid var(--border-color);
        }
        html[dir="rtl"] .option-group label:first-of-type {
            border-right: none;
        }
        html[dir="rtl"] .option-group label:last-of-type {
            border-right: 1px solid var(--border-color);
        }

        .option-group label .icon {
            width: 20px;
            height: 20px;
            vertical-align: middle;
        }

        /* --- Custom Language Selector --- */
.language-selector {
    position: relative;
    width: fit-content;  /* התאמה לתוכן */
    min-width: 120px;
}

        .language-selector-button {
            width: 100%;
            background-color: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-family: 'Poppins', sans-serif;
            font-size: 13px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all .2s ease;
            box-sizing: border-box;
            direction: ltr;
        }

        .language-selector-button:hover {
            border-color: var(--accent-primary);
        }

        .language-selector-button span {
            flex: 1;
            text-align: left;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            margin-right: 8px;
        }

        .language-selector-button svg {
            flex-shrink: 0;
            transition: transform 0.2s ease;
        }

        .language-selector-button.open svg {
            transform: rotate(180deg);
        }

        .language-dropdown {
            position: absolute;
            bottom: 100%;
            left: 0;
            right: 0;
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            max-height: 250px;
            z-index: 1000;
            margin-bottom: 5px;
            display: none;
            overflow: hidden;
            direction: ltr;
        }

        .language-dropdown.show {
            display: block;
        }

        .language-search {
            padding: 12px;
            border-bottom: 1px solid var(--border-color);
            background-color: var(--bg-secondary);
        }

        .language-search input {
            width: 100%;
            padding: 8px 12px;
            background-color: var(--bg-primary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            border-radius: 4px;
            font-family: 'Poppins', sans-serif;
            font-size: 13px;
            box-sizing: border-box;
            outline: none;
            transition: border-color 0.2s ease;
            direction: ltr;
            text-align: left;
        }

        .language-search input:focus {
            border-color: var(--accent-primary);
        }

        .language-search input::placeholder {
            color: var(--text-secondary);
        }

        .language-list {
            list-style: none;
            padding: 0;
            margin: 0;
            max-height: 180px;
            overflow-y: auto;
        }

        .language-list::-webkit-scrollbar {
            width: 6px;
        }

        .language-list::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        .language-list::-webkit-scrollbar-thumb {
            background-color: var(--accent-secondary);
            border-radius: 3px;
        }

        .language-list li {
            padding: 12px 15px;
            cursor: pointer;
            font-size: 13px;
            color: var(--text-primary);
            transition: background-color 0.2s ease;
            border-bottom: 1px solid transparent;
            text-align: left;
            direction: ltr;
        }

        .language-list li:last-child {
            border-bottom: none;
        }

        .language-list li:hover {
            background-color: var(--accent-primary);
            color: #fff;
        }

        .language-list li.selected {
            background-color: var(--accent-primary);
            color: #fff;
            font-weight: 500;
        }

        .language-list li.hidden {
            display: none;
        }

        /* RTL Support for Language Selector */
        html[dir="rtl"] .language-selector-button {
            direction: ltr;
        }

        html[dir="rtl"] .language-selector-button span {
            text-align: left;
            margin-left: 0;
            margin-right: 8px;
        }

        html[dir="rtl"] .language-dropdown {
            direction: ltr;
        }

        html[dir="rtl"] .language-search input {
            direction: ltr;
            text-align: left;
        }

        html[dir="rtl"] .language-list li {
            text-align: left;
            direction: ltr;
        }

        /* Additional RTL improvements */
        html[dir="rtl"] .content {
            direction: rtl;
        }

        html[dir="rtl"] .setting-category {
            direction: rtl;
        }

        html[dir="rtl"] .setting-item > div:first-child {
            margin-left: 15px;
            margin-right: 0;
        }

        html[dir="rtl"] .setting-item > div:last-child {
            margin-right: 15px;
            margin-left: 0;
        }
    </style>
</head>
<body>
    <div class="drag-bar">
        <h2 data-i18n="settings-title">Settings</h2>
        <button id="close-button" title="Close">&times;</button>
    </div>
    <div class="content">
        <div class="setting-category">
            <h3 class="setting-category-title">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"></path></svg>
                <span data-i18n="appearance">Appearance</span>
            </h3>
            <div class="setting-item">
                <div class="setting-label"><strong data-i18n="theme-label">Theme</strong><span data-i18n="theme-desc">Select your preferred theme.</span></div>
                <div id="theme-options" class="option-group">
                    <input type="radio" id="theme-light" name="theme" value="light">
                    <label for="theme-light" data-i18n="theme-light">Light</label>

                    <input type="radio" id="theme-dark" name="theme" value="dark">
                    <label for="theme-dark" data-i18n="theme-dark">Dark</label>

                    <input type="radio" id="theme-system" name="theme" value="system">
                    <label for="theme-system" data-i18n="theme-system">System</label>
                </div>
            </div>
            <div class="setting-item">
                <div class="setting-label"><strong data-i18n="showChatTitle-label">Show Chat Title</strong><span data-i18n="showChatTitle-desc">Display conversation name in the window.</span></div>
                <label class="toggle-switch"><input type="checkbox" id="setting-showChatTitle"><span class="slider"></span></label>
            </div>
            <div class="setting-item">
                <div class="setting-label"><strong data-i18n="draggableButtons-label">Draggable Buttons</strong><span data-i18n="draggableButtons-desc">Allow reordering of toolbar buttons.</span></div>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <button id="reset-button-order" class="action-button" data-i18n="resetOrder" style="min-width: auto;">Reset Order</button>
                    <label class="toggle-switch"><input type="checkbox" id="setting-draggableButtonsEnabled"><span class="slider"></span></label>
                </div>
            </div>
        </div>
        <div class="setting-category">
            <h3 class="setting-category-title">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M19.9142 9.40429C19.9142 9.13571 19.9429 8.87143 19.9857 8.60286L21.6571 7.25286C21.8429 7.09714 21.8857 6.83286 21.7857 6.61857L20.2286 3.97714C20.1286 3.76286 19.8857 3.65571 19.6714 3.72571L17.6571 4.52286C17.1143 4.11143 16.5286 3.76286 15.9 3.48571L15.5857 1.32571C15.5571 1.09714 15.3571 0.928571 15.1143 0.928571H11.8857C11.6429 0.928571 11.4429 1.09714 11.4143 1.32571L11.1 3.48571C10.4714 3.76286 9.88571 4.11143 9.34286 4.52286L7.32857 3.72571C7.11429 3.65571 6.87143 3.76286 6.77143 3.97714L5.21429 6.61857C5.11429 6.83286 5.15714 7.09714 5.34286 7.25286L7.01429 8.60286C6.97143 8.87143 6.94286 9.13571 6.94286 9.40429C6.94286 9.67286 6.97143 9.93714 7.01429 10.2057L5.34286 11.5557C5.15714 11.7114 5.11429 11.9757 5.21429 12.19L6.77143 14.8314C6.87143 15.0457 7.11429 15.1529 7.32857 15.0829L9.34286 14.2857C9.88571 14.6971 10.4714 15.0457 11.1 15.3229L11.4143 17.4829C11.4429 17.7114 11.6429 17.88 11.8857 17.88H15.1143C15.3571 17.88 15.5571 17.7114 15.5857 17.4829L15.9 15.3229C16.5286 15.0457 17.1143 14.6971 17.6571 14.2857L19.6714 15.0829C19.8857 15.1529 20.1286 15.0457 20.2286 14.8314L21.7857 12.19C21.8857 11.9757 21.8429 11.7114 21.6571 11.5557L19.9857 10.2057C19.9429 9.93714 19.9142 9.67286 19.9142 9.40429ZM13.5 12.4343C11.5286 12.4343 9.94286 10.8486 9.94286 8.87714C9.94286 6.90571 11.5286 5.32 13.5 5.32C15.4714 5.32 17.0571 6.90571 17.0571 8.87714C17.0571 10.8486 15.4714 12.4343 13.5 12.4343Z"></path></svg>
                <span data-i18n="general">General</span>
            </h3>
            <div class="setting-item">
                <div class="setting-label"><strong data-i18n="language-label">Language</strong><span data-i18n="language-desc">Select interface language.</span></div>
                <div class="language-selector">
                    <button id="language-selector-button" class="language-selector-button">
                        <span>English</span>
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>
                    </button>
                    <div id="language-dropdown" class="language-dropdown">
                        <div class="language-search">
                            <input type="text" id="language-search-input" placeholder="Search languages...">
                        </div>
                        <ul id="language-list" class="language-list">
                            <!-- Languages will be populated by JS -->
                        </ul>
                    </div>
                </div>
            </div>
            <div class="setting-item">
                <div class="setting-label"><strong data-i18n="updates-label">Application Updates</strong><span data-i18n="updates-desc">Check for the latest version.</span></div>
                <div style="display: flex; align-items: center;">
                    <button id="manual-check-for-updates-button" class="action-button" data-i18n="checkForUpdates">Check for Updates</button>
                </div>
            </div>
            <div class="setting-item">
                <div class="setting-label"><strong data-i18n="autoStart-label">Run on System Startup</strong><span data-i18n="autoStart-desc">Start GeminiDesk automatically.</span></div>
                <label class="toggle-switch"><input type="checkbox" id="setting-autoStart"><span class="slider"></span></label>
            </div>
            <div class="setting-item">
                <div class="setting-label"><strong data-i18n="alwaysOnTop-label">Always on Top</strong><span data-i18n="alwaysOnTop-desc">Keep the window above others.</span></div>
                <label class="toggle-switch"><input type="checkbox" id="setting-alwaysOnTop"><span class="slider"></span></label>
            </div>
            <div class="setting-item">
                <div class="setting-label"><strong data-i18n="showInTaskbar-label">Show in Taskbar</strong><span data-i18n="showInTaskbar-desc">Let the app icon appear in the taskbar.</span></div>
                <label class="toggle-switch"><input type="checkbox" id="setting-showInTaskbar"><span class="slider"></span></label>
            </div>
            <div class="setting-item">
                <div class="setting-label"><strong data-i18n="enableCanvasResizing-label">Automatic Canvas Resizing</strong><span data-i18n="enableCanvasResizing-desc">Resize the canvas when needed.</span></div>
                <label class="toggle-switch"><input type="checkbox" id="setting-enableCanvasResizing"><span class="slider"></span></label>
            </div>
            <div class="setting-item">
                <div class="setting-label"><strong data-i18n="restoreWindows-label">Restore Windows on Launch</strong><span data-i18n="restoreWindows-desc">Reopen previous windows at startup.</span></div>
                <label class="toggle-switch"><input type="checkbox" id="setting-restoreWindows"><span class="slider"></span></label>
            </div>
            <div class="setting-item">
                <div class="setting-label"><strong data-i18n="showCloseButton-label">Show Close Button</strong><span data-i18n="showCloseButton-desc">Add a close button to each window.</span></div>
                <label class="toggle-switch"><input type="checkbox" id="setting-showCloseButton"><span class="slider"></span></label>
            </div>
            <div class="setting-item">
                <div class="setting-label"><strong data-i18n="showExportButton-label">Show Export Button</strong><span data-i18n="showExportButton-desc">Add an export chat button to each window, exp.</span></div>
                <label class="toggle-switch"><input type="checkbox" id="setting-showExportButton"><span class="slider"></span></label>
            </div>
            <div class="setting-item">
                <div class="setting-label"><strong data-i18n="defaultMode-label">Default Mode</strong><span data-i18n="defaultMode-desc">Choose what opens by default.</span></div>
                <div id="default-mode-options" class="option-group">
                    <input type="radio" id="mode-ask" name="defaultMode" value="ask">
                    <label for="mode-ask" title="Ask"><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"></path></svg></label>

                    <input type="radio" id="mode-gemini" name="defaultMode" value="gemini">
                    <label for="mode-gemini" title="Gemini"><svg class="icon" viewBox="0 0 65 65" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M57.8647 29.0109C52.865 26.8587 48.4905 23.9061 44.7393 20.1567C40.99 16.4074 38.0373 12.031 35.8851 7.03132C35.0589 5.11516 34.395 3.14552 33.886 1.12608C33.72 0.465846 33.128 0.00109863 32.4475 0.00109863C31.7669 0.00109863 31.1749 0.465846 31.009 1.12608C30.4999 3.14552 29.836 5.11332 29.0098 7.03132C26.8576 12.031 23.905 16.4074 20.1556 20.1567C16.4063 23.9061 12.0299 26.8587 7.03022 29.0109C5.11406 29.8371 3.14442 30.501 1.12498 31.0101C0.464747 31.176 0 31.768 0 32.4486C0 33.1291 0.464747 33.7211 1.12498 33.8871C3.14442 34.3961 5.11222 35.06 7.03022 35.8862C12.0299 38.0384 16.4045 40.9911 20.1556 44.7404C23.9068 48.4897 26.8576 52.8661 29.0098 57.8658C29.836 59.782 30.4999 61.7516 31.009 63.771C31.1749 64.4313 31.7669 64.896 32.4475 64.896C33.128 64.896 33.72 64.4313 33.886 63.771C34.395 61.7516 35.0589 59.7838 35.8851 57.8658C38.0373 52.8661 40.99 48.4916 44.7393 44.7404C48.4886 40.9911 52.865 38.0384 57.8647 35.8862C59.7809 35.06 61.7505 34.3961 63.7699 33.8871C64.4302 33.7211 64.8949 33.1291 64.8949 32.4486C64.8949 31.768 64.4302 31.176 63.7699 31.0101C61.7505 30.501 59.7827 29.8371 57.8647 29.0109Z" fill="currentColor"></path></svg></label>

                    <input type="radio" id="mode-aistudio" name="defaultMode" value="aistudio">
                    <label for="mode-aistudio" title="AI Studio"><svg class="icon" aria-label="Google AI Studio logo" viewBox="0 0 299 310" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M125.365 32C120.691 38.5727 116.782 45.7277 113.766 53.334H64C40.4361 53.3342 21.3342 72.4361 21.334 96V245.334C21.3344 268.898 40.4362 288 64 288H213.334C236.898 288 256 268.898 256 245.334V179.93C263.778 175.739 270.945 170.561 277.334 164.563V245.334C277.334 280.68 248.68 309.334 213.334 309.334H64C28.6542 309.334 0.00038177 280.68 0 245.334V96C0.000171479 60.654 28.654 32.0002 64 32H125.365Z" fill="currentColor"></path><path d="M281.333 71.5244C269.006 66.218 258.221 58.9383 248.972 49.6942C239.728 40.4502 232.448 29.6601 227.142 17.3332C225.105 12.6088 223.468 7.75264 222.213 2.77367C221.804 1.14585 220.344 0 218.666 0C216.988 0 215.529 1.14585 215.12 2.77367C213.865 7.75264 212.228 12.6043 210.191 17.3332C204.884 29.6601 197.605 40.4502 188.36 49.6942C179.116 58.9383 168.326 66.218 155.999 71.5244C151.275 73.5614 146.419 75.1984 141.44 76.4533C139.812 76.8626 138.666 78.3222 138.666 80C138.666 81.6778 139.812 83.1374 141.44 83.5467C146.419 84.8016 151.271 86.4386 155.999 88.4756C168.326 93.782 179.112 101.062 188.36 110.306C197.609 119.55 204.884 130.34 210.191 142.667C212.228 147.391 213.865 152.247 215.12 157.226C215.529 158.854 216.988 160 218.666 160C220.344 160 221.804 158.854 222.213 157.226C223.468 152.247 225.105 147.396 227.142 142.667C232.448 130.34 239.728 119.554 248.972 110.306C258.216 101.062 269.006 93.782 281.333 88.4756C286.057 86.4386 290.914 84.8016 295.893 83.5467C297.52 83.1374 298.666 81.6778 298.666 80C298.666 78.3222 297.52 76.8626 295.893 76.4533C290.914 75.1984 286.062 73.5614 281.333 71.5244Z" fill="currentColor"></path></svg></label>
                </div>
            </div>
        </div>
        <div class="setting-category">
            <h3 class="setting-category-title">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg>
                <span data-i18n="notifications">Notifications</span>
            </h3>
            <div class="setting-item">
                <div class="setting-label"><strong data-i18n="autoCheckNotifications-label">Automatic Daily Check</strong><span data-i18n="autoCheckNotifications-desc">Check for new messages once a day.</span></div>
                <label class="toggle-switch"><input type="checkbox" id="setting-autoCheckNotifications"><span class="slider"></span></label>
            </div>
            <div class="setting-item">
                <div class="setting-label"><strong data-i18n="manualCheckNotifications-label">Manual Check</strong><span data-i18n="manualCheckNotifications-desc">Check for new messages now.</span></div>
                <button id="check-for-notifications-button" class="action-button" data-i18n="checkNow">Check Now</button>
            </div>
        </div>
        <div class="setting-category">
            <h3 class="setting-category-title">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M20 5H4C2.89543 5 2 5.89543 2 7V17C2 18.1046 2.89543 19 4 19H20C21.1046 19 22 18.1046 22 17V7C22 5.89543 21.1046 5 20 5ZM11 16H4V14H11V16ZM14.5 16H12.5V14H14.5V16ZM11 13H4V11H11V13ZM11 10H4V8H11V10ZM16.5 16H18.5C18.7761 16 19 15.7761 19 15.5V14.5C19 14.2239 18.7761 14 18.5 14H16.5C16.2239 14 16 14.2239 16 14.5V15.5C16 15.7761 16.2239 16 16.5 16ZM15.5 13H12.5V11H15.5V13ZM18.5 13H16.5V11H18.5V13ZM20 10H12V8H20V10Z"></path></svg>
                <span data-i18n="shortcuts">Shortcuts</span>
            </h3>
            <div class="setting-item">
                <div class="setting-label"><strong data-i18n="shortcutsGlobal-label">Enable Global Shortcuts</strong><span data-i18n="shortcutsGlobal-desc">Allow shortcuts to work from any app.</span></div>
                <label class="toggle-switch"><input type="checkbox" id="setting-shortcutsGlobal"><span class="slider"></span></label>
            </div>
            <div class="setting-item">
                <div class="setting-label"><strong data-i18n="showHide-label">Show / Hide Window</strong><span data-i18n="showHide-desc">Toggle window visibility.</span></div>
                <button class="record-button" data-key="showHide" data-i18n="recordButton-default">Click to record</button>
            </div>
            <div class="setting-item">
                <div class="setting-label"><strong data-i18n="openNewWindow-label">Open New Window</strong><span data-i18n="openNewWindow-desc">Creates a new, separate window.</span></div>
                <button class="record-button" data-key="newWindow" data-i18n="recordButton-default">Click to record</button>
            </div>
            <div class="setting-item">
                <div class="setting-label"><strong data-i18n="quitApplication-label">Quit Application</strong><span data-i18n="quitApplication-desc">Close the application.</span></div>
                <button class="record-button" data-key="quit" data-i18n="recordButton-default">Click to record</button>
            </div>
            <div class="setting-item">
                <div class="setting-label"><strong data-i18n="closeWindow-label">Close Window</strong><span data-i18n="closeWindow-desc">Closes the current window.</span></div>
                <button class="record-button" data-key="closeWindow" data-i18n="recordButton-default">Click to record</button>
            </div>
            <div class="setting-item">
                <div class="setting-label"><strong data-i18n="showInstructions-label">Show Instructions</strong><span data-i18n="showInstructions-desc">See the welcome screen.</span></div>
                <button class="record-button" data-key="showInstructions" data-i18n="recordButton-default">Click to record</button>
            </div>
            <div class="setting-item">
                <div class="setting-label"><strong data-i18n="refreshWindow-label">Refresh Window</strong><span data-i18n="refreshWindow-desc">Reloads the current page content.</span></div>
                <button class="record-button" data-key="refresh" data-i18n="recordButton-default">Click to record</button>
            </div>
            <div class="setting-item">
                <div class="setting-label"><strong data-i18n="searchChats-label">Search Chats</strong><span data-i18n="searchChats-desc">Focus the chat search bar.</span></div>
                <button class="record-button" data-key="search" data-i18n="recordButton-default">Click to record</button>
            </div>
<div class="setting-item">
    <div class="setting-label"><strong data-i18n="findInPage-label">Find in Page</strong><span data-i18n="findInPage-desc">Opens the find bar.</span></div>
    <button class="record-button" data-key="findInPage" data-i18n="recordButton-default">Click to record</button>
</div>
            <div class="setting-item">
                <div class="setting-label"><strong data-i18n="screenshot-label">Take Screenshot & Paste</strong><span data-i18n="screenshot-desc">Copies screen area to clipboard and pastes it.</span></div>
                <button class="record-button" data-key="screenshot" data-i18n="recordButton-default">Click to record</button>
            </div>
            <div class="setting-item">
                <div class="setting-label"><strong data-i18n="newChatPro-label">New Chat (Pro)</strong><span data-i18n="newChatPro-desc">Starts a new chat with the Pro model.</span></div>
                <button class="record-button" data-key="newChatPro" data-i18n="recordButton-default">Click to record</button>
            </div>
            <div class="setting-item">
                <div class="setting-label"><strong data-i18n="newChatFlash-label">New Chat (Flash)</strong><span data-i18n="newChatFlash-desc">Starts a new chat with the Flash model.</span></div>
                <button class="record-button" data-key="newChatFlash" data-i18n="recordButton-default">Click to record</button>
            </div>
        </div>
        <div class="setting-category">
            <h3 class="setting-category-title" style="color: var(--danger-color);">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"></path></svg>
                <span data-i18n="dangerZone">Danger Zone</span>
            </h3>
            <div class="setting-item">
                <div class="setting-label"><strong data-i18n="resetSettings-label">Reset All Settings</strong><span data-i18n="resetSettings-desc">This action cannot be undone.</span></div>
                <button id="reset-button" data-i18n="reset">Reset</button>
            </div>
        </div>
    </div>

<script src="translations.js"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
    // Check if electronAPI exists (for Electron environment)
    if (!window.electronAPI) { 
        console.warn('electronAPI not available - running in browser mode');
        // Initialize with default values for testing
        initializeBrowserMode();
        return; 
    }
    
    const electronAPI = window.electronAPI;

    let currentLanguage = 'en';
    let currentSettings = {};

    // RTL languages list
    const rtlLanguages = ['he', 'ar', 'fa', 'ur'];

    const applyTranslations = (lang) => {
        const dict = translations[lang] || translations.en;
        document.querySelectorAll('[data-i18n]').forEach(el => {
            const key = el.getAttribute('data-i18n');
            if (dict[key]) {
                el.textContent = dict[key];
            }
        });
        document.querySelectorAll('.record-button').forEach(button => {
            const key = button.dataset.key;
            if (currentSettings.shortcuts && currentSettings.shortcuts[key]) {
                button.textContent = currentSettings.shortcuts[key];
            } else {
                button.textContent = dict['recordButton-default'];
            }
        });
        currentLanguage = lang;
        document.documentElement.setAttribute('lang', lang);
        
        // Set direction based on language
        const isRTL = rtlLanguages.includes(lang);
        document.documentElement.setAttribute('dir', isRTL ? 'rtl' : 'ltr');
        
        updateLangSelectorUI(lang);
    };

    // --- Custom Language Selector Logic ---
    const languageSelector = document.querySelector('.language-selector');
    const langButton = document.getElementById('language-selector-button');
    const langDropdown = document.getElementById('language-dropdown');
    const langSearch = document.getElementById('language-search-input');
    const langList = document.getElementById('language-list');

    const languages = [
        { code: 'en', name: 'English' }, { code: 'fr', name: 'Français' }, { code: 'he', name: 'עברית' },
        { code: 'ru', name: 'Русский' }, { code: 'es', name: 'Español' }, { code: 'de', name: 'Deutsch' },
        { code: 'it', name: 'Italiano' }, { code: 'pt', name: 'Português' }, { code: 'nl', name: 'Nederlands' },
        { code: 'pl', name: 'Polski' }, { code: 'tr', name: 'Türkçe' }, { code: 'zh', name: '简体中文' },
        { code: 'ja', name: '日本語' }, { code: 'ko', name: '한국어' }, { code: 'hi', name: 'हिन्दी' },
        { code: 'ar', name: 'العربية' }, { code: 'bn', name: 'বাংলা' }, { code: 'id', name: 'Bahasa Indonesia' },
        { code: 'ur', name: 'اردو' }, { code: 'sw', name: 'Kiswahili' }, { code: 'ta', name: 'தமிழ்' },
        { code: 'vi', name: 'Tiếng Việt' }, { code: 'th', name: 'ไทย' }, { code: 'cs', name: 'Čeština' },
    ];

    languages.forEach(lang => {
        const li = document.createElement('li');
        li.dataset.lang = lang.code;
        li.textContent = lang.name;
        langList.appendChild(li);
    });

    langButton.addEventListener('click', (e) => {
        e.stopPropagation();
        const isOpen = langDropdown.classList.contains('show');
        langDropdown.classList.toggle('show');
        langButton.classList.toggle('open', !isOpen);
        
        if (!isOpen) {
            langSearch.focus();
            langSearch.value = '';
            langList.querySelectorAll('li').forEach(li => li.classList.remove('hidden'));
        }
    });

    langSearch.addEventListener('input', () => {
        const filter = langSearch.value.toLowerCase();
        langList.querySelectorAll('li').forEach(li => {
            const text = li.textContent.toLowerCase();
            li.classList.toggle('hidden', !text.includes(filter));
        });
    });

    langList.addEventListener('click', (e) => {
        if (e.target.tagName === 'LI') {
            const langCode = e.target.dataset.lang;
            langDropdown.classList.remove('show');
            langButton.classList.remove('open');
            applyTranslations(langCode);
            electronAPI.updateSetting('language', langCode);
        }
    });

    document.addEventListener('click', (e) => {
        if (!languageSelector.contains(e.target)) {
            langDropdown.classList.remove('show');
            langButton.classList.remove('open');
        }
    });

    const updateLangSelectorUI = (langCode) => {
        const lang = languages.find(l => l.code === langCode) || languages[0];
        langButton.querySelector('span').textContent = lang.name;
        langList.querySelectorAll('li').forEach(li => {
            li.classList.toggle('selected', li.dataset.lang === langCode);
        });
    };


    // --- Theme Selection --- 
    const themeRadios = document.querySelectorAll('input[name="theme"]');
    electronAPI.theme.getSetting().then(currentTheme => {
        document.getElementById(`theme-${currentTheme}`).checked = true;
    });
    document.querySelectorAll('input[name="defaultMode"]').forEach(radio => {
        radio.addEventListener('change', (e) => {
            electronAPI.updateSetting('defaultMode', e.target.value);
        });
    });
    themeRadios.forEach(radio => {
        radio.addEventListener('change', (e) => {
            electronAPI.theme.set(e.target.value);
        });
    });

    // --- Sync UI with settings ---
    const syncUi = (settings) => {
        try {
            currentSettings = settings;
            document.getElementById('setting-autoStart').checked = settings.autoStart || false;
            document.getElementById('setting-showInTaskbar').checked = settings.showInTaskbar || false;
            document.getElementById('setting-alwaysOnTop').checked = settings.alwaysOnTop || false;
            document.getElementById('setting-autoCheckNotifications').checked = settings.autoCheckNotifications || false;
            document.getElementById('setting-enableCanvasResizing').checked = settings.enableCanvasResizing || false;
            document.getElementById('setting-shortcutsGlobal').checked = settings.shortcutsGlobal !== false;
            document.getElementById('setting-showChatTitle').checked = settings.showChatTitle !== false;
            document.getElementById('setting-restoreWindows').checked = settings.restoreWindows || false;
            document.getElementById('setting-showCloseButton').checked = settings.showCloseButton || false;
            document.getElementById('setting-draggableButtonsEnabled').checked = settings.draggableButtonsEnabled !== false;
            document.getElementById('setting-showExportButton').checked = settings.showExportButton || false;
            document.getElementById(`mode-${settings.defaultMode || 'ask'}`).checked = true;
            applyTranslations(settings.language || 'en');
            document.querySelectorAll('.record-button').forEach(button => {
                const key = button.dataset.key;
                if(settings.shortcuts && settings.shortcuts[key]) {
                    button.textContent = settings.shortcuts[key];
                } else {
                    button.textContent = (translations[currentLanguage] || translations.en)['recordButton-default'];
                }
            });
        } catch (error) {
            console.error('Error syncing UI:', error);
        }
    };

    // Initialize settings
    electronAPI.getSettings().then(syncUi).catch(error => {
        console.error('Error getting settings:', error);
    });
    
    electronAPI.onSettingsUpdated(syncUi);

    // --- General Event Listeners ---
    document.getElementById('close-button').addEventListener('click', () => {
        if (window.close) {
            window.close();
        } else {
            electronAPI.closeWindow();
        }
    });
    
    document.getElementById('reset-button').addEventListener('click', () => {
        electronAPI.showConfirmReset();
    });

    document.getElementById('reset-button-order').addEventListener('click', () => {
        electronAPI.updateSetting('buttonOrder', []);
    });
    
    // --- Toggle Switches ---
    document.getElementById('setting-autoStart').addEventListener('change', (e) => {
        electronAPI.updateSetting('autoStart', e.target.checked);
    });
    
    document.getElementById('setting-alwaysOnTop').addEventListener('change', (e) => {
        electronAPI.updateSetting('alwaysOnTop', e.target.checked);
    });

    document.getElementById('setting-showInTaskbar').addEventListener('change', (e) => {
        electronAPI.updateSetting('showInTaskbar', e.target.checked);
    });
    
    document.getElementById('setting-autoCheckNotifications').addEventListener('change', (e) => {
        electronAPI.updateSetting('autoCheckNotifications', e.target.checked);
    });
    
    document.getElementById('setting-enableCanvasResizing').addEventListener('change', (e) => {
        electronAPI.updateSetting('enableCanvasResizing', e.target.checked);
    });

    document.getElementById('setting-shortcutsGlobal').addEventListener('change', (e) => {
        electronAPI.updateSetting('shortcutsGlobal', e.target.checked);
    });

    document.getElementById('setting-showChatTitle').addEventListener('change', (e) => {
        electronAPI.updateSetting('showChatTitle', e.target.checked);
    });

    document.getElementById('setting-restoreWindows').addEventListener('change', (e) => {
        electronAPI.updateSetting('restoreWindows', e.target.checked);
    });

    document.getElementById('setting-showCloseButton').addEventListener('change', (e) => {
        electronAPI.updateSetting('showCloseButton', e.target.checked);
    });

    document.getElementById('setting-showExportButton').addEventListener('change', (e) => {
        electronAPI.updateSetting('showExportButton', e.target.checked);
    });

    document.getElementById('setting-draggableButtonsEnabled').addEventListener('change', (e) => {
        electronAPI.updateSetting('draggableButtonsEnabled', e.target.checked);
    });

    // --- Manual Action Buttons ---
    document.getElementById('manual-check-for-updates-button').addEventListener('click', () => {
        electronAPI.checkForUpdates();
    });

    document.getElementById('check-for-notifications-button').addEventListener('click', () => {
        electronAPI.manualCheckForNotifications();
    });

    // --- Shortcut Recording Logic ---
    let isRecording = false;
    
    const startRecording = (button) => {
        if (isRecording) return;
        
        isRecording = true;
        const originalText = button.textContent;
        const pressedKeys = new Set();
        
        button.textContent = (translations[currentLanguage] || translations.en)['recording'];
        button.classList.add('is-recording');
        
        const cleanup = () => {
            document.removeEventListener('keydown', keydownHandler, true);
            document.removeEventListener('keyup', keyupHandler, true);
            button.classList.remove('is-recording');
            isRecording = false;
        };
        
        const keydownHandler = (e) => {
            e.preventDefault();
            e.stopPropagation();
            
            if (e.ctrlKey) pressedKeys.add('Control');
            if (e.altKey) pressedKeys.add('Alt');
            if (e.shiftKey) pressedKeys.add('Shift');
            if (e.metaKey) pressedKeys.add('Super');
            
            if (!['Control', 'Alt', 'Shift', 'Meta'].includes(e.key)) {
                const keyCode = e.code.replace('Key', '').replace('Digit', '');
                pressedKeys.add(keyCode);
            }
            
            button.textContent = Array.from(pressedKeys).join('+');
        };
        
        const keyupHandler = (e) => {
            e.preventDefault();
            e.stopPropagation();
            
            if (e.key === 'Escape') {
                button.textContent = (translations[currentLanguage] || translations.en)['recordButton-default'];
                cleanup();
                return;
            }
            
            const finalShortcut = Array.from(pressedKeys).join('+');
            
            if (pressedKeys.size > 1 && finalShortcut !== 'Control+Alt+Shift') {
                button.textContent = finalShortcut;
                electronAPI.updateSetting(`shortcuts.${button.dataset.key}`, finalShortcut);
            } else {
                button.textContent = (translations[currentLanguage] || translations.en)['recordButton-default'];
            }
            
            cleanup();
        };
        
        document.addEventListener('keydown', keydownHandler, true);
        document.addEventListener('keyup', keyupHandler, true);
    };

    document.querySelectorAll('.record-button').forEach(button => {
        button.addEventListener('click', () => startRecording(button));
    });
});

// --- Theme Application Logic ---
function applyTheme(theme) {
    if (theme === 'light') {
        document.documentElement.classList.add('light-mode');
    } else {
        document.documentElement.classList.remove('light-mode');
    }
}

if (window.electronAPI) {
    window.electronAPI.theme.getResolved().then(applyTheme);
    window.electronAPI.theme.onUpdate(applyTheme);
}

// Initialize browser mode for testing without Electron
function initializeBrowserMode() {
    console.log('Initializing browser mode');
    // This function can be left empty or with minimal mocks for this task
    const mockSettings = {
        autoStart: false,
        alwaysOnTop: false,
        autoCheckNotifications: true,
        enableCanvasResizing: true,
        shortcuts: {
            showHide: 'Control+Space',
            newWindow: 'Control+N',
            quit: 'Control+Q',
            showInstructions: 'F1',
            refresh: 'F5',
            search: 'Control+F',
            screenshot: 'Control+Shift+S',
            newChatPro: 'Control+Shift+P',
            newChatFlash: 'Control+Shift+F'
        }
    };
    
    // Update UI with mock settings
    document.getElementById('setting-autoStart').checked = mockSettings.autoStart;
    document.getElementById('setting-alwaysOnTop').checked = mockSettings.alwaysOnTop;
    document.getElementById('setting-autoCheckNotifications').checked = mockSettings.autoCheckNotifications;
    document.getElementById('setting-enableCanvasResizing').checked = mockSettings.enableCanvasResizing;
    
    document.querySelectorAll('.record-button').forEach(button => {
        const key = button.dataset.key;
        if(mockSettings.shortcuts[key]) {
            button.textContent = mockSettings.shortcuts[key];
        }
    });
}
</script>
</body>
</html>
